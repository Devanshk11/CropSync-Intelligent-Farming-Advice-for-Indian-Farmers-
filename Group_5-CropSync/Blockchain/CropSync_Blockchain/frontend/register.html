<!DOCTYPE html>
<html>
  <head>
    <title>Register Farmer - CropSync</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f9fa;
        padding: 40px;
        color: #333;
      }
      h2 {
        color: #2e8b57;
      }
      form {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 2px 10px rgba(0,0,0,0.05);
        max-width: 400px;
      }
      label {
        font-weight: 500;
      }
      input {
        width: 100%;
        padding: 8px;
        margin-top: 4px;
        margin-bottom: 15px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      button {
        background-color: #2e8b57;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
      #status {
        margin-top: 20px;
        font-weight: 500;
      }
    </style>
  </head>

<body>
  <h2>üë®‚Äçüåæ Farmer Registration</h2>

  <form id="registerForm">
    <label>Name:</label>
    <input type="text" id="name" required>

    <label>Location:</label>
    <input type="text" id="location" required>

    <label>Land Size (in acres):</label>
    <input type="number" id="landSize" required>

    <button type="submit">Register</button>
  </form>

  <p id="status"></p>


  <script>
    const contractABI = [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "name": "farmers",
        "outputs": [
          { "internalType": "string", "name": "name", "type": "string" },
          { "internalType": "string", "name": "location", "type": "string" },
          { "internalType": "uint256", "name": "landSize", "type": "uint256" },
          { "internalType": "bool", "name": "registered", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function",
        "constant": true
      },
      {
        "inputs": [],
        "name": "inspector",
        "outputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "stateMutability": "view",
        "type": "function",
        "constant": true
      },
      {
        "inputs": [{ "internalType": "address", "name": "", "type": "address" }],
        "name": "journeys",
        "outputs": [
          { "internalType": "string", "name": "cropName", "type": "string" },
          { "internalType": "string", "name": "sowingDate", "type": "string" },
          { "internalType": "string", "name": "monitoringNotes", "type": "string" },
          { "internalType": "string", "name": "pesticideUsed", "type": "string" },
          { "internalType": "string", "name": "pesticideDate", "type": "string" },
          { "internalType": "bool", "name": "inspected", "type": "bool" },
          { "internalType": "bool", "name": "approved", "type": "bool" },
          { "internalType": "string", "name": "yieldDate", "type": "string" },
          { "internalType": "bool", "name": "badgeGenerated", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function",
        "constant": true
      },
      {
        "inputs": [
          { "internalType": "string", "name": "_name", "type": "string" },
          { "internalType": "string", "name": "_location", "type": "string" },
          { "internalType": "uint256", "name": "_landSize", "type": "uint256" }
        ],
        "name": "registerFarmer",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "_cropName", "type": "string" },
          { "internalType": "string", "name": "_sowingDate", "type": "string" }
        ],
        "name": "addSowingData",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{ "internalType": "string", "name": "_notes", "type": "string" }],
        "name": "addMonitoringNotes",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "string", "name": "_pesticideUsed", "type": "string" },
          { "internalType": "string", "name": "_date", "type": "string" }
        ],
        "name": "addPesticideData",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          { "internalType": "address", "name": "farmerAddress", "type": "address" },
          { "internalType": "bool", "name": "_approved", "type": "bool" }
        ],
        "name": "inspectCrop",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{ "internalType": "string", "name": "_yieldDate", "type": "string" }],
        "name": "addYieldData",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "generateBadge",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [{ "internalType": "address", "name": "farmerAddress", "type": "address" }],
        "name": "getCropJourney",
        "outputs": [
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "bool", "name": "", "type": "bool" },
          { "internalType": "bool", "name": "", "type": "bool" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "bool", "name": "", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function",
        "constant": true
      },
      {
        "inputs": [{ "internalType": "address", "name": "_farmerAddress", "type": "address" }],
        "name": "getFarmer",
        "outputs": [
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "string", "name": "", "type": "string" },
          { "internalType": "uint256", "name": "", "type": "uint256" },
          { "internalType": "bool", "name": "", "type": "bool" }
        ],
        "stateMutability": "view",
        "type": "function",
        "constant": true
      }
    ];

    const contractAddress = "0x41470E8f446D234e2FD8E86d00e311d3624b5037";

    let web3;
    let farmerContract;
    let currentAccount;

    window.addEventListener("load", async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await ethereum.request({ method: "eth_requestAccounts" });

        const accounts = await web3.eth.getAccounts();
        currentAccount = accounts[0];

        farmerContract = new web3.eth.Contract(contractABI, contractAddress);

        document.getElementById("registerForm").addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("name").value;
          const location = document.getElementById("location").value;
          const landSize = document.getElementById("landSize").value;

          try {
            await farmerContract.methods.registerFarmer(name, location, landSize).send({ from: currentAccount });
            document.getElementById("status").innerText = "‚úÖ Farmer registered!";
          } catch (err) {
            console.error(err);
            document.getElementById("status").innerText = "‚ùå Error: " + err.message;
          }
        });
      } else {
        alert("Please install MetaMask to use CropSync.");
      }
    });
  </script>
</body>
</html>
